<!DOCTYPE html>
<html lang="en">
<head>
	<title>three.js webgl</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
</head>
<body>

	<div id="container" style="width:1024px;height:768px;"></div>

	<script id="vertexShader" type="x-shader/x-vertex">

		attribute vec2 uv2;
		varying vec2 vUV;
		varying vec2 vUV2;
		uniform vec2 grp_lt;
		uniform float grp_w;
		uniform float grp_h;

		void main()	{
			vUV = uv;
			vUV2 = vec2((uv2.s - grp_lt.x) / grp_w, (uv2.t - grp_lt.y) / grp_h);
			gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
		}

	</script>

	<script id="fragmentShader" type="x-shader/x-fragment">

		varying vec2 vUV;
		varying vec2 vUV2;
		uniform float time;
		uniform sampler2D sMainTex;
		uniform sampler2D sGraphicTex;

		void main()	{
			float ga = texture2D( sGraphicTex, vUV2 ).a;
			gl_FragColor = (1.0 - ga) * texture2D( sMainTex, vUV ) + ga * texture2D( sGraphicTex, vUV2);
		}

	</script>

	<!-- Import maps polyfill -->
	<!-- Remove this when import maps will be widely supported -->
	<script async src="https://unpkg.com/es-module-shims@1.3.6/dist/es-module-shims.js"></script>

	<script type="importmap">
		{
			"imports": {
				"three": "./node_modules/three/build/three.module.js",
				"three/addons/": "./node_modules/three/examples/jsm/"
			}
		}
	</script>

	<script type="module">

		import * as THREE from 'three';
        import { OrbitControls } from './node_modules/three/examples/jsm/controls/OrbitControls.js';

		let camera, scene, renderer;

		let cameraControl;

		let uniforms;

		init();
		animate();

		function init() {

			const container = document.getElementById('container');

			camera = new THREE.PerspectiveCamera(60, 1024.0 / 768.0, 0.1, 100);
            camera.up.set(0, 1, 0);
			//camera.position.set(0, -10, 10);
			//camera.lookAt(0, 0, 0);

			scene = new THREE.Scene();

			const geometry = new THREE.PlaneGeometry(10, 10).rotateX(-Math.PI / 2.0);
			geometry.computeVertexNormals();

			// second uv
			//let uvs = geometry.attributes.uv.array;
			//geometry.setAttribute('uv2', new THREE.Float32BufferAttribute(uvs, 2));
			geometry.attributes.uv2 = geometry.attributes.uv.clone();

			const main_tex = new THREE.TextureLoader().load('../../data/checked.jpg');
            const gr_tex = new THREE.TextureLoader().load('../../data/ralph-lauren.png');

			uniforms = {
				time: { value: 1.0 },
				grp_lt: { value: new THREE.Vector2(0.3, 0.2) },
                grp_w: { value: 0.3 },
                grp_h: { value: 0.6 },
				sMainTex: { value: main_tex },
                sGraphicTex: { value: gr_tex },
			};

			const material = new THREE.ShaderMaterial({

				uniforms: uniforms,
				vertexShader: document.getElementById('vertexShader').textContent,
				fragmentShader: document.getElementById('fragmentShader').textContent

			});

			const mesh = new THREE.Mesh(geometry, material);
			scene.add(mesh);

			renderer = new THREE.WebGLRenderer();
			renderer.setSize(1024, 768);
			container.appendChild(renderer.domElement);

			cameraControl = new OrbitControls(camera, renderer.domElement);
			cameraControl.target.set(0, 0, 0);
			cameraControl.update();

			camera.position.set(0, 10, 10);
			camera.lookAt(0, 0, 0);

			onWindowResize();

			window.addEventListener('resize', onWindowResize);

		}

		function onWindowResize() {

			//renderer.setSize(window.innerWidth, window.innerHeight);

		}

		//

		function animate() {

			requestAnimationFrame(animate);

			//uniforms['time'].value = performance.now() / 1000;

			renderer.render(scene, camera);

		}

	</script>

</body>
</html>